<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <div style="display: flex; justify-content: center; align-items: center; margin: auto; height: 100vh;">
        <canvas width="1000" height="700" style="border:solid 1px black" id="myCanvas"></canvas>
    </div>
    <div style="justify-content: left; margin: auto; height: 10px;">
        <button onclick="reset()">Reset</button>
    </div>
    <script>
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");
        const W = canvas.width;
        const H = canvas.height;


        const bg = new Image();
        bg.src = '/images/fundo.svg';

        const cauldron = new Image();
        cauldron.src = '/images/cauldron.svg';

        const redPotion = new Image();
        redPotion.src = 'images/redPotion.svg';

        const yellowPotion = new Image();
        yellowPotion.src = 'images/yellowPotion.svg';

        const bluePotion = new Image();
        bluePotion.src = 'images/bluePotion.svg';

        let potions = [
            { image: redPotion, x: 670, y: 150, width: redPotion.width * 0.75, height: redPotion.height * 0.75 },
            { image: yellowPotion, x: 770, y: 150, width: yellowPotion.width * 0.75, height: yellowPotion.height * 0.75 },
            { image: bluePotion, x: 870, y: 150, width: bluePotion.width * 0.75, height: bluePotion.height * 0.75 }
        ];

        let selectedPotion = null;
        let offsetX, offsetY;

        function draw() {
            // initial()
            ctx.clearRect(0, 0, W, H);
            ctx.drawImage(bg, 0, 0);
            ctx.drawImage(cauldron, 200, 300, cauldron.width * 2.5, cauldron.height * 2.5);
            potions.forEach(potion => {
                ctx.drawImage(potion.image, potion.x, potion.y, potion.width, potion.height);
            });
        }

        function isInside(pos, rect) {
            return pos.x > rect.x && pos.x < rect.x + rect.width && pos.y < rect.y + rect.height && pos.y > rect.y;
        }

        canvas.addEventListener('mousedown', (e) => {
            const pos = {
                x: e.clientX - canvas.offsetLeft,
                y: e.clientY - canvas.offsetTop
            };

            potions.forEach(potion => {
                if (isInside(pos, potion)) {
                    selectedPotion = potion;
                    offsetX = pos.x - potion.x;
                    offsetY = pos.y - potion.y;
                }
            });
        });

        canvas.addEventListener('mousedown', (e) => {
            const pos = {
                x: e.clientX - canvas.offsetLeft,
                y: e.clientY - canvas.offsetTop
            };

            potions.forEach(potion => {
                if (isInside(pos, potion)) {
                    document.body.style.cursor = 'pointer';
                }
            });
        });

        function checkCollision(potion, cauldron) {
            return (
                potion.x < cauldron.x + cauldron.width &&
                potion.x + potion.width > cauldron.x &&
                potion.y < cauldron.y + cauldron.height &&
                potion.y + potion.height > cauldron.y
            );
        }

        canvas.addEventListener('mousemove', (e) => {
            if (selectedPotion !== null) {
                document.body.style.cursor = 'pointer';

                const pos = {
                    x: e.clientX - canvas.offsetLeft,
                    y: e.clientY - canvas.offsetTop
                };

                selectedPotion.x = pos.x - offsetX;
                selectedPotion.y = pos.y - offsetY;

                if (checkCollision(selectedPotion, { x: 200, y: 300, width: cauldron.width * 2.5, height: 25 })) {
                    if (selectedPotion.image == redPotion) {
                        selectedPotion.image.src = '/images/redPotionCollide.svg';
                    }
                    if (selectedPotion.image == yellowPotion) {
                        selectedPotion.image.src = '/images/yellowPotionCollide.svg';
                    }
                    if (selectedPotion.image == bluePotion) {
                        selectedPotion.image.src = '/images/bluePotionCollide.svg';
                    }
                } else {
                    if (selectedPotion.image == redPotion) {
                        selectedPotion.image.src = '/images/redPotion.svg';
                    }
                    if (selectedPotion.image == yellowPotion) {
                        selectedPotion.image.src = '/images/yellowPotion.svg';
                    }
                    if (selectedPotion.image == bluePotion) {
                        selectedPotion.image.src = '/images/bluePotion.svg';
                    }
                }
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            selectedPotion = null;
            document.body.style.cursor = 'default';
        });

        function reset() {
            ctx.reset()
            cauldron.src = '/images/cauldron.svg';
            redPotion.src = 'images/redPotion.svg';
            yellowPotion.src = 'images/yellowPotion.svg';
            bluePotion.src = 'images/bluePotion.svg';
            potions = [
                { image: redPotion, x: 670, y: 150, width: redPotion.width * 0.75, height: redPotion.height * 0.75 },
                { image: yellowPotion, x: 770, y: 150, width: yellowPotion.width * 0.75, height: yellowPotion.height * 0.75 },
                { image: bluePotion, x: 870, y: 150, width: bluePotion.width * 0.75, height: bluePotion.height * 0.75 }
            ];
            draw()
        }

        window.onload = function () {
            draw();
        };

    </script>
</body>

</html>